<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Información del Cliente</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: #f9f9f9;
        }
        
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 15px;
        }
        
        h2 {
            color: #333;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 18px;
            text-align: center;
        }
        
        .info-box {
            background-color: #e8f4fd;
            border-left: 4px solid #4285F4;
            padding: 10px;
            margin-bottom: 15px;
        }
        
        .info-box p {
            margin: 0;
            color: #555;
        }
        
        .client-info {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
        }
        
        .client-row {
            display: flex;
            margin-bottom: 8px;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        
        .client-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .client-label {
            font-weight: bold;
            width: 100px;
            color: #555;
        }
        
        .client-value {
            flex: 1;
        }
        
        .btn {
            background-color: #4285F4;
            color: white;
            border: none;
            padding: 10px 0;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .btn:hover {
            background-color: #3367D6;
        }
        
        .notes {
            background-color: #fffde7;
            border-left: 3px solid #ffd54f;
            padding: 10px;
            font-style: italic;
            color: #5d4037;
            margin-top: 15px;
        }
        
        .form-container {
            margin-top: 15px;
        }
        
        .form-row {
            margin-bottom: 10px;
        }
        
        .form-row label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        .form-row input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .debug-info {
            margin-top: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 150px;
            overflow-y: auto;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Información del Cliente</h2>
        
        <div class="info-box">
            <p>Información del cliente actual en Zoho CRM. Puede personalizar la vista usando el formulario.</p>
        </div>
        
        <div class="client-info">
            <div class="client-row">
                <div class="client-label">Nombre:</div>
                <div class="client-value" id="client-name">Cliente Actual</div>
            </div>
            <div class="client-row">
                <div class="client-label">Email:</div>
                <div class="client-value" id="client-email">cliente@ejemplo.com</div>
            </div>
            <div class="client-row">
                <div class="client-label">Teléfono:</div>
                <div class="client-value" id="client-phone">123-456-7890</div>
            </div>
            <div class="client-row">
                <div class="client-label">ID Cliente:</div>
                <div class="client-value" id="client-id">CRM-001</div>
            </div>
            <div class="client-row">
                <div class="client-label">Empresa:</div>
                <div class="client-value" id="client-company">Empresa S.A.</div>
            </div>
        </div>
        
        <div class="notes" id="client-notes">
            Cliente: <span id="note-client-name">Cliente Actual</span>. Información actualizada el <span id="current-date"></span>. Este cliente requiere seguimiento periódico.
        </div>
        
        <button class="btn" onclick="showAdditionalInfo()">
            Ver Detalles Adicionales
        </button>
        
        <div class="form-container">
            <h3 style="font-size: 16px; color: #333;">Personalizar Información</h3>
            <div class="form-row">
                <label for="name-input">Nombre:</label>
                <input type="text" id="name-input" placeholder="Ingrese nombre">
            </div>
            <div class="form-row">
                <label for="email-input">Email:</label>
                <input type="email" id="email-input" placeholder="Ingrese email">
            </div>
            <div class="form-row">
                <label for="phone-input">Teléfono:</label>
                <input type="text" id="phone-input" placeholder="Ingrese teléfono">
            </div>
            <div class="form-row">
                <label for="company-input">Empresa:</label>
                <input type="text" id="company-input" placeholder="Ingrese empresa">
            </div>
            <button class="btn" onclick="updateClientInfo()" style="background-color: #009688;">Actualizar Información</button>
        </div>
        
        <button class="btn" onclick="toggleDebugInfo()" style="background-color: #9e9e9e; margin-top: 20px;">
            Mostrar Información de Depuración
        </button>
        
        <div id="debug-info" class="debug-info"></div>
    </div>
    
    <script>
        var debugInfo = {};
        
        // Función que se ejecuta cuando se carga la página
        document.addEventListener('DOMContentLoaded', function() {
            // Establecer la fecha actual
            var today = new Date();
            var formattedDate = today.getDate() + '/' + (today.getMonth() + 1) + '/' + today.getFullYear();
            document.getElementById('current-date').textContent = formattedDate;
            
            // Capturar información de depuración
            debugInfo.url = window.location.href;
            debugInfo.referrer = document.referrer;
            debugInfo.userAgent = navigator.userAgent;
            debugInfo.parentAvailable = (window.parent !== window);
            debugInfo.parentOrigin = "No se puede determinar por seguridad";
            debugInfo.urlParams = {};
            
            // Procesar parámetros de URL
            try {
                var urlParams = new URLSearchParams(window.location.search);
                debugInfo.rawParams = window.location.search;
                
                // Guardar todos los parámetros para depuración
                urlParams.forEach(function(value, key) {
                    debugInfo.urlParams[key] = value;
                });
                
                // Procesar parámetros específicos
                if (urlParams.has('name')) {
                    document.getElementById('client-name').textContent = urlParams.get('name');
                    document.getElementById('name-input').value = urlParams.get('name');
                    document.getElementById('note-client-name').textContent = urlParams.get('name');
                }
                
                if (urlParams.has('email')) {
                    document.getElementById('client-email').textContent = urlParams.get('email');
                    document.getElementById('email-input').value = urlParams.get('email');
                }
                
                if (urlParams.has('phone')) {
                    document.getElementById('client-phone').textContent = urlParams.get('phone');
                    document.getElementById('phone-input').value = urlParams.get('phone');
                }
                
                if (urlParams.has('id')) {
                    document.getElementById('client-id').textContent = urlParams.get('id');
                }
                
                if (urlParams.has('company')) {
                    document.getElementById('client-company').textContent = urlParams.get('company');
                    document.getElementById('company-input').value = urlParams.get('company');
                }
            } catch (e) {
                debugInfo.urlParamError = e.toString();
                console.log("Error al procesar parámetros URL:", e);
            }
            
            // Intentar detectar Zoho CRM
            try {
                debugInfo.hasZoho = (typeof ZOHO !== 'undefined');
                debugInfo.hasZohoEmbeddedApp = (typeof ZOHO !== 'undefined' && ZOHO.embeddedApp);
                debugInfo.hasZohoCRM = (typeof ZOHO !== 'undefined' && ZOHO.CRM);
            } catch (e) {
                debugInfo.zohoError = e.toString();
            }
            
            // Intentar obtener información de Zoho si está disponible
            try {
                if (typeof ZOHO !== 'undefined' && ZOHO.embeddedApp) {
                    debugInfo.tryingZoho = "Intentando inicializar ZOHO SDK";
                    
                    ZOHO.embeddedApp.on("PageLoad", function(data) {
                        debugInfo.pageLoadData = data;
                        updateDebugInfo();
                        
                        ZOHO.embeddedApp.init().then(function() {
                            debugInfo.sdkInitialized = true;
                            updateDebugInfo();
                            
                            ZOHO.CRM.UI.Record.getEntityId().then(function(data) {
                                debugInfo.entityData = data;
                                updateDebugInfo();
                                
                                if (data && data.data && data.data.length > 0) {
                                    var recordId = data.data[0].id;
                                    var moduleAPIName = data.data[0].module;
                                    
                                    ZOHO.CRM.API.getRecord({
                                        Entity: moduleAPIName, 
                                        RecordID: recordId
                                    }).then(function(response) {
                                        if (response && response.data && response.data.length > 0) {
                                            debugInfo.recordData = response.data[0];
                                            updateDebugInfo();
                                            
                                            var record = response.data[0];
                                            updateClientFromRecord(record);
                                        }
                                    });
                                }
                            });
                        });
                    });
                }
            } catch (e) {
                debugInfo.zohoInitError = e.toString();
                updateDebugInfo();
            }
            
            // Actualizar información de depuración en la interfaz
            updateDebugInfo();
        });
        
        // Actualizar información de depuración
        function updateDebugInfo() {
            var debugElement = document.getElementById('debug-info');
            debugElement.textContent = JSON.stringify(debugInfo, null, 2);
        }
        
        // Mostrar/ocultar información de depuración
        function toggleDebugInfo() {
            var debugElement = document.getElementById('debug-info');
            if (debugElement.style.display === 'none' || debugElement.style.display === '') {
                debugElement.style.display = 'block';
            } else {
                debugElement.style.display = 'none';
            }
        }
        
        // Actualizar cliente desde datos de registro
        function updateClientFromRecord(record) {
            // Actualizar nombre
            var name = record.Full_Name || record.Name || record.Last_Name;
            if (name) {
                document.getElementById('client-name').textContent = name;
                document.getElementById('name-input').value = name;
                document.getElementById('note-client-name').textContent = name;
            }
            
            // Actualizar email
            var email = record.Email;
            if (email) {
                document.getElementById('client-email').textContent = email;
                document.getElementById('email-input').value = email;
            }
            
            // Actualizar teléfono
            var phone = record.Phone || record.Mobile;
            if (phone) {
                document.getElementById('client-phone').textContent = phone;
                document.getElementById('phone-input').value = phone;
            }
            
            // Actualizar ID
            if (record.id) {
                document.getElementById('client-id').textContent = record.id;
            }
            
            // Actualizar empresa
            var company = record.Company || record.Account_Name;
            if (company) {
                document.getElementById('client-company').textContent = company;
                document.getElementById('company-input').value = company;
            }
        }
        
        // Función para actualizar la información del cliente
        function updateClientInfo() {
            var name = document.getElementById('name-input').value;
            var email = document.getElementById('email-input').value;
            var phone = document.getElementById('phone-input').value;
            var company = document.getElementById('company-input').value;
            
            if (name) {
                document.getElementById('client-name').textContent = name;
                document.getElementById('note-client-name').textContent = name;
            }
            
            if (email) {
                document.getElementById('client-email').textContent = email;
            }
            
            if (phone) {
                document.getElementById('client-phone').textContent = phone;
            }
            
            if (company) {
                document.getElementById('client-company').textContent = company;
            }
            
            // Actualizar nota
            var today = new Date();
            var formattedDate = today.getDate() + '/' + (today.getMonth() + 1) + '/' + today.getFullYear();
            document.getElementById('current-date').textContent = formattedDate;
            
            alert("Información del cliente actualizada correctamente.");
        }
        
        // Función para mostrar información adicional
        function showAdditionalInfo() {
            var name = document.getElementById('client-name').textContent;
            var company = document.getElementById('client-company').textContent;
            var email = document.getElementById('client-email').textContent;
            var phone = document.getElementById('client-phone').textContent;
            
            var today = new Date();
            var formattedDate = today.getDate() + '/' + (today.getMonth() + 1) + '/' + today.getFullYear();
            
            var message = "Información adicional sobre " + name + ":\n\n" +
                          "• Empresa: " + company + "\n" +
                          "• Email: " + email + "\n" +
                          "• Teléfono: " + phone + "\n" +
                          "• Fecha de consulta: " + formattedDate + "\n" +
                          "• Estado: Cliente activo\n" +
                          "• Categoría: Premium\n" +
                          "• Última interacción: " + formattedDate + "\n" +
                          "• Próxima acción: Seguimiento comercial";
            
            alert(message);
        }
    </script>
</body>
</html>
